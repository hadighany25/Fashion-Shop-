<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout | Fashion Shop</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="logo">Fashion Shop</div>
        <ul class="nav-links">
          <li><a href="index.html">Back to Shop</a></li>
        </ul>
      </nav>
    </header>

    <div class="payment-layout">
      <div class="payment-methods">
        <div class="method-item active" onclick="switchMethod('aba')">
          <i class="fas fa-money-bill-wave"></i> ABA PAY
        </div>
        <div class="method-item" onclick="switchMethod('acleda')">
          <i class="fas fa-university"></i> ACLEDA
        </div>
        <div class="method-item" onclick="switchMethod('wing')">
          <i class="fas fa-plane"></i> WING BANK
        </div>
        <div class="method-item" onclick="switchMethod('khqr')">
          <i class="fas fa-qrcode"></i> KHQR
        </div>
        <div class="method-item" onclick="switchMethod('card')">
          <i class="fas fa-credit-card"></i> Credit Card
        </div>
      </div>

      <div class="payment-content">
        <div id="qr-area" class="qr-display active">
          <h2 id="bank-name">ABA PAY</h2>
          <div class="qr-box">
            <div class="qr-placeholder-img">
              <img
                id="qr-image"
                src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=ABA-Pay"
                alt="QR Code"
                width="150"
              />
            </div>
            <p
              style="
                margin-top: 15px;
                font-weight: 600;
                font-size: 1.2rem;
                color: var(--primary);
              "
            >
              Total: <span id="payment-total">$0.00</span>
            </p>
          </div>
          <p style="text-align: center; color: #555">
            សូមស្កេន QR កូដខាងលើដើម្បីបង់ប្រាក់
          </p>
          <button class="btn-confirm" onclick="processPayment()">
            I have Paid
          </button>
        </div>

        <div id="card-area" class="card-form">
          <h2>Card Information</h2>
          <div class="form-group">
            <label>Cardholder Name</label>
            <input type="text" placeholder="SOK DARA" required />
          </div>
          <div class="form-group">
            <label>Card Number</label>
            <input type="text" placeholder="4222 2222 2222 2222" required />
          </div>
          <div class="form-group" style="display: flex; gap: 20px">
            <div>
              <label>Expiry Date</label>
              <input type="text" placeholder="MM/YY" />
            </div>
            <div>
              <label>CVC</label>
              <input type="text" placeholder="123" />
            </div>
          </div>
          <button class="btn-confirm" onclick="processPayment()">
            Pay <span id="card-total-btn">$0.00</span> Now
          </button>
        </div>
      </div>
    </div>

    <div id="success-msg" class="success-popup">
      <i class="fas fa-check-circle"></i>
      <h2>Payment Successful!</h2>
      <p class="kh">ការបង់ប្រាក់បានជោគជ័យ។ អរគុណ!</p>
      <button
        class="cta-button"
        onclick="window.location.href='index.html'"
        style="margin-top: 20px"
      >
        Shop More
      </button>
    </div>

    <script>
      function getCart() {
        const cartString = localStorage.getItem("shoppingCart");
        return cartString ? JSON.parse(cartString) : [];
      }

      document.addEventListener("DOMContentLoaded", () => {
        const totalElement = document.getElementById("payment-total");
        const cardBtnTotal = document.getElementById("card-total-btn");

        const cart = getCart();
        let finalTotal = 0.0;

        if (cart.length > 0) {
          cart.forEach((item) => {
            finalTotal += parseFloat(item.price) * item.quantity;
          });
        }

        const totalFormatted = finalTotal.toFixed(2);
        totalElement.innerText = "$" + totalFormatted;
        cardBtnTotal.innerText = "$" + totalFormatted;
      });

      function switchMethod(method) {
        document
          .querySelectorAll(".method-item")
          .forEach((item) => item.classList.remove("active"));
        event.currentTarget.classList.add("active");

        const qrArea = document.getElementById("qr-area");
        const cardArea = document.getElementById("card-area");
        const bankName = document.getElementById("bank-name");
        const qrImage = document.getElementById("qr-image");

        // លាក់/បង្ហាញ Area
        if (method === "card") {
          qrArea.classList.remove("active");
          cardArea.classList.add("active");
        } else {
          cardArea.classList.remove("active");
          qrArea.classList.add("active");

          if (method === "aba") {
            bankName.innerText = "ABA PAY";
            qrImage.src =
              "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=ABA";
          } else if (method === "acleda") {
            bankName.innerText = "ACLEDA MOBILE";
            qrImage.src =
              "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=Acleda";
          } else if (method === "wing") {
            bankName.innerText = "WING BANK";
            qrImage.src =
              "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=Wing";
          } else if (method === "khqr") {
            bankName.innerText = "KHQR (All Banks)";
            qrImage.src =
              "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=KHQR";
          }
        }
      }

      function processPayment() {
        const btn = document.querySelector(
          '.payment-content .btn-confirm:not([style*="display: none"])'
        );
        if (btn) {
          const originalText = btn.innerHTML;
          btn.innerHTML = "Checking...";
          btn.style.opacity = "0.7";

          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.opacity = "1";

            document.getElementById("success-msg").style.display = "block";
            document.querySelector(".payment-layout").style.opacity = "0.2";

            // លុប Cart ទាំងមូល ក្រោយទូទាត់ជោគជ័យ
            localStorage.removeItem("shoppingCart");
          }, 2000);
        }
      }
    </script>
  </body>
</html>
